<meta http-equiv="Content-Security-Policy" content="script-src 'none'; style-src 'sha256-v7Sjpv9uQQxtcKB6gHVHlOMJJybM68GhtfAotGfNbFw='">
<style id="brave_speedreader_style">h1, h2, h3, h4, h5, h6 {
  font-weight: bold;
}

h1 {
  font-size: 2.2em;
  line-height: 1.3em;
  margin-top: 0;
  margin-bottom: 0.5em;
}

h2 {
  font-size: 1.5em;
  line-height: 1.4em;
}

h3 {
  font-size: 1.2em;
  line-height: 1em;
}

h4, h5, h6 {
  font-size: 1.1em;
  line-height: 1.3em;
}

p {
  font-size: 1.2em;
  line-height: 1.5em;
}

li {
  font-size: 1.2rem;
  line-height: 1.5rem;
}

.subhead {
  font-weight: normal;
}

.subhead, .subheading {
  font-size: 1.5em;
  line-height: 1em;
  font-weight: normal;
  color: var(--summary-text-color);
}

.metadata {
  margin-top: -0.75em;
  margin-bottom: 1.45em;
}

.metadata * {
  font-size: 1em !important;
  font-weight: normal !important;
  font-style: normal !important;
  display: inline !important;
  margin: 0;
}

.metadata :matches(.byline, .date) {
  display: inline !important;
}

.date {
  display: inline-block;
}

.show_original {
  display: inline-block;
  float: right;
}

.metadata :matches(ul, ol, li) {
  list-style-type: none;
  -webkit-padding-start: 0;
}

.title+.metadata {
  margin-top: -0.75em;
}

.subhead+.metadata {
  margin-top: -0.7em;
}

a {
  text-decoration: underline;
  text-decoration-color: inherit;
}

a[href] {
  color: #4C54D2;
}

#article {
  text-rendering: optimizeLegibility;
  font-family: "Georgia", "Times New Roman", Times, serif;
  user-select: unset;
}

#article * {
  /* Scale down anything larger than our view. Max-width maintains aspect ratios on images. */
  max-width: 680;
}

#article img {
  /* By default, images are centered on their own line. */
  margin-bottom: 0.5em;
  display: block;
  height: auto;
}

#article img.reader-image-tiny {
  display: inline;
  margin: 0;
}

#article .leading-image, figure, .auxiliary {
  margin-bottom: 1.15em;
}

#article .leading-image img {
  margin: auto;
  display: block;
  clear: both;
}

#article .leading-image .credit {
  margin: 0;
}

#article .leading-image, #article figure {
  font-size: 0.85em;
  line-height: 1.4em;
}

body {
  background-color: var(--article-background-color);
  color: var(--article-text-color);
  padding-left: 120px !important;
}

body.watch #article .leading-image,
body.watch #article figure {
  font-size: 0.8125rem;
}

#article .leading-image :matches(.caption, .credit), #article figcaption {
  margin-top: 0.8em;
}

#article figcaption>* {
  margin-top: 0.25em;
  margin-bottom: 0.25em;
}

#article :matches(.leading-image, figure) p {
  margin-top: 0.4em;
  margin-bottom: 0.4em;
}

#article .leading-image .credit+.caption {
  margin-top: 0.1em;
}

#article .auxiliary {
  display: block;
  clear: both;
  font-size: 0.75em;
  line-height: 1.4em;
  text-align: start;
}

#article .pullquote {
  font-size: 1.42em;
  line-height: 1.38em;
  font-weight: 300;
  font-style: italic;
}

#article .pullquote:not(.float) {
  margin-top: 1em;
  margin-bottom: 1em;
  -webkit-margin-start: 1em;
  max-width: calc(100% - 1em);
}

#article .auxiliary>*:not(img) {
  -webkit-margin-start: 0;
}

#article .auxiliary.float img, #article .auxiliary>*:first-child:not(img) {
  margin: 0;
}


article {
  text-align: start;
  word-wrap: break-word;
  hyphens: auto;
}

article.rtl {
  direction: rtl;
}


/* If the element immediately after an image is inline, it might bump up against the image. */

#article .auxiliary img+* {
  display: block;
}

#article .auxiliary figcaption {
  font-size: 100%;
}

#article .auxiliary * {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

body:not(.watch) #article .float.left {
  float: left;
  margin-right: 20px;
}

body:not(.watch) #article .float.right {
  float: right;
  margin-left: 20px;
}

body.watch #article .float {
  width: auto !important;
}

#article .clear {
  clear: both;
}

#article ul.list-style-type-none, #article ol.list-style-type-none, #article .list-style-type-none>li {
  list-style-type: none;
  -webkit-padding-start: 0;
}

#article div.scrollable {
  overflow-x: scroll;
  word-wrap: normal;
}

#article div.scrollable table {
  max-width: none;
}

#article-summary {
  font-size: 1.5em;
  line-height: 1.4em;
  color: var(--summary-text-color);
}

#article .leading-image, #article figure, #article .auxiliary:not(.pullquote) {
  font-family: Arial, Helvetica, sans-serif;
}

#article .leading-image,
#article figure,
#article .auxiliary,
#article .pullquote {
  color: var(--quote-text-color);
}

figure {
  margin: 0;
}

body:not(.watch) figure:not(.float) {
  margin-top: 1.4em;
  margin-bottom: 1.4em;
}

hr {
  position: relative;
  display: block;
  width: 100%;
  margin: 2.5em 0 3.5em;
  padding: 0;
  background: rgba(0, 0, 0, 0.2);
  height: 1px;
  border: 0;
}

pre {
  font-family: "Lucida Console", Courier, monospace;
  font-size: 0.87em;
  line-height: 1.45em;
}

pre,
code {
  white-space: pre-wrap;
}

blockquote,
q {
  color: var(--quote-text-color);
}

blockquote:not(.pullquote) {
  margin-left: 2px;
  margin-right: 6px;
  padding-left: 16px;
}

blockquote:not(.simple):not(.pullquote) {
  border-left: 3px solid rgba(0, 0, 0, 0.1);
}

q.pullquote {
  display: block;
}

.pullquote q::before, .pullquote q::after, q.pullquote::before, q.pullquote::after {
  content: "";
}

/* Collapse excess whitespace. */

article p>p:empty, article div>p:empty, article p>div:empty, article div>div:empty, article p+br, article img+br {
  display: none;
}

article table {
  font-size: 0.9em;
  text-align: start;
  word-wrap: break-word;
  border-collapse: collapse;
}

article table td, article table th {
  padding: 0.25em 0.5em;
  border: 1px solid rgb(216, 216, 216);
}

.delimiter {
  margin-left: 0.45em;
  margin-right: 0.45em;
  margin-top: 0.07em;
  padding: 0;
}

.metadata.singleline .delimiter::after {
  content: "•";
}

.metadata:not(.singleline) .delimiter {
  content: "";
  display: block !important;
}

article table th {
  background-color: var(--article-background-color);
}

article sup, article sub {
  line-height: 1;
  font-size: 0.75em;
}

.hidden {
  display: none;
}

@media screen {
  body {
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    -webkit-text-size-adjust: none;
  }

  body.mac {
    background-color: transparent;
  }

  #article {
    pointer-events: auto;
    overflow: visible;
  }

  #article:focus {
    outline: none;
  }

  #article {
    margin-left: auto;
    margin-right: auto;
    padding-top: 4.5em;
    padding-bottom: 35px;
    position: relative;
    border-top: 1px solid rgba(0, 0, 0, 0.2);
  }

  body article {
    padding: 0 4px;
  }

  #article {
    margin-top: 0;
    border-top: none;
  }

  #article:last-of-type {
    padding-bottom: 45px;
  }

  article video {
    width: 100%;
    height: auto;
    position: relative;
  }
}

#article .extendsBeyondTextColumn {
  max-width: none;
}

.iframe-wrapper {
  background-color: black;
  max-width: none;
  text-align: center;
}

iframe {
  border: 0;
}

@media only screen and (min-width: 780px) {
  #article {
    max-width: 800px;
    margin: 0 auto;
  }

  /* Readable margins. */
  /* body #article {
    max-width: 83.2ex;
  } */
}

/* Use slightly smaller page padding when vertically constrained. */

@media screen and (max-height: 700px) {
  #article {
    padding-top: 32px;
    padding-bottom: 32px;
  }
}

@media (prefers-color-scheme: dark) {
  html:not([data-theme]) {
    --background-color: #17171F;
    --article-background-color: #1E2029;
    --summary-text-color: #C2C4CF;
    --article-text-color: #F0F2FF;
    --quote-text-color: #C2C4CF;
  }
}

html,
html[data-theme='light'] {
  --background-color: #F8F9FA;
  --article-background-color: #FFFFFF;
  --summary-text-color: #495057;
  --article-text-color: #212529;
  --quote-text-color: rgba(0, 0, 0, 0.65);

  background-color: var(--background-color);
}

html[data-theme='sepia'] {
  --background-color: #E9E0CA;
  --article-background-color: #F2EBD9;
  --summary-text-color: #5B4635;
  --article-text-color: #331E05;
  --quote-text-color: rgba(0, 0, 0, 0.65);
}

html[data-theme='dark'] {
  --background-color: #17171F;
  --article-background-color: #1E2029;
  --summary-text-color: #C2C4CF;
  --article-text-color: #F0F2FF;
  --quote-text-color: #C2C4CF;
}</style><title>Lift and shift Windows applications to containers</title><meta charset="UTF-8"/><body id="article"><h1 class="title metadata">Lift and shift Windows applications to containers</h1><p class="subhead metadata">Microsoft’s own experience with Microsoft 365 shows that moving to cloud-native is possible, even when you have a lot of code to move.</p><div class=""><p class="metadata">By Simon Bisson</p><a class="metadata show_original" href="" id="c93e2206-2f31-4ddc-9828-2bb8e8ed940e"></a></div><hr class=""></hr>
		
		
		
		
	
		
			
			
				<p>There’s an old adage often shared by developers building on Microsoft platforms: “How can you tell if a Microsoft product is ready for prime time? When Microsoft uses it for one of its flagship applications or services.”</p><p>That means it was time to start using the Orleans distributed application framework when it powered large parts of Halo, time to use Fluid Framework when it went into Teams, and on and on. The latest service to get the stamp of approval is Windows containers on <a href="https://www.infoworld.com/article/3637002/azure-updates-aks-with-new-kubernetes-technologies.html">Azure Kubernetes Service</a>. Microsoft has spent the past year or so working <a href="https://customers.microsoft.com/en-in/story/1536483517282553662-modernizing-microsoft-365-windows-containers-azure-kubernetes-service" rel="nofollow">to move large pieces of the Microsoft 365 platform onto AKS</a> with the aim of making it more scalable and flexible in the light of the rapid changes in work patterns driven by the COVID-19 pandemic.</p><h2>Moving Microsoft 365 to cloud-native and AKS</h2><p>Moving a service the size of Microsoft 365 to containers was a complex process; it had been hard enough going from the Office Online single-tenant systems to a multitenant virtualized architecture, especially when combined with a move to CI/CD (continuous integration and continuous delivery). That first shift put in place many of the architectural refinements that would be necessary for a shift to containers. First and foremost was moving state from the application VMs to what we now know as the Microsoft Graph. Still, a lot of the service was custom, especially for managing availability and supporting networking between the machines and services that made up a tenant.</p><p>That approach led to a lack of consistency: Application builds had to target specific platforms. As a result, it built in architectural inefficiencies as different server types were required to host different VMs, increasing the complexity and costs of the data centers that hosted Microsoft 365 services. That added to the cost of running the service. Loads couldn’t easily be moved between servers to ensure optimal utilization, which reduced the cost advantages of hyperscale.</p><p>Building on Kubernetes requires rethinking what had been monolithic services and refactoring them to work as scalable microservices. However, as they could use Windows containers, the team didn’t lose anything they were already using: AKS container hosts could be provisioned with the appropriate .NET tools and services with access to Windows APIs. While those host features are shared between containers, container isolation ensures they can be accessed securely.</p><p>At the same time, the smaller size of container instances compared to VMs ensures that more applications can be run on the same number of physical hosts, reducing overall costs and allowing more efficient use of Azure hardware. Microsoft’s internal accounting systems mean that groups need to budget for cloud usage, so any savings can be invested elsewhere in the service.</p><p>There are other benefits of moving to cloud-native architecture for Microsoft 365. All developers share the same API surface, which simplifies tests and change management and allows the team to use CI/CD as part of an application ops model, keeping platform ops separate from the code and managing the AKS features used by the service. Applications are built and deployed first to test clusters, then to early rings for internal users and external insiders before being moved to production.</p><h2>How to containerize your own code</h2><p>If Microsoft can move its code to containers and AKS, how can you do the same? Clearly, much of the change has to be organizational. You need a mature devops practice that’s already split into three parts, with dedicated infrastructure, platform, and applications teams. Then you need to lift and shift that code, making necessary changes to support working in a container environment. Monolithic applications are unlikely to function well in a container-based environment, especially one like AKS where much of your platform operations are automated, scaling on the fly and using platform-level service meshes to manage declarative networking and security.</p><p>Usefully, Microsoft’s Windows Containers team <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/quick-start/lift-shift-to-containers?WT.mc_id=modinfra-73152-viniap" rel="nofollow">recently put out documentation based on its experience</a> working with customers like Microsoft 365. This gives you a set of pointers to consider when moving an application from a Windows Server environment—even one that’s virtualized—to containers. Working with containers isn’t like working with a server, even if we do get access to familiar APIs and libraries.</p><h2>Keep an eye out for container blockers</h2><p>Much of the list of blockers is common sense. Containers aren’t for interactive applications, and there’s no GUI support. The host OS is a version of Windows Server Core, so code needs to be designed to work for it, for example, only supporting silent installs or not allowing RDP access. With no UI, code needs alternate management APIs, for example, providing endpoints for use with Windows Admin Center.</p><p>Similarly, you should make sure that code never stores data inside a container. That includes settings. Containers need to be treated as stateless, ephemeral items that are created and destroyed as required by a container orchestration platform such as Kubernetes. If you’re targeting AKS, consider using an Azure storage instance, such as Azure Files or a Blob to hold state and data for your containers. That way, if a container handling a payment process fails, a replacement can pick up session state and carry on without a user noticing. Similarly, if demand requires extra containers, they can pick up application state and settings as soon as they’re ready to go.</p><p>There are other limitations. Your code needs to run on Windows Server 2016 or newer, so older applications may need some compatibility work. The same goes for older versions of the .NET Framework. Although Microsoft provides container images with supported versions, you’re best off making sure code runs under more recent versions which are designed to support microservice architectures and have a smaller footprint, allowing more containers to run on the same host. It's important to avoid any dependencies on Active Directory roles, or for that matter, any Windows Server infrastructure features. Your container is for your application, nothing else.</p><h2>Take advantage of cloud services where possible</h2><p>If you’re planning on moving to AKS or <a href="https://www.infoworld.com/article/3212211/what-is-aci-microsofts-azure-container-instances-explained.html">Azure Container Instances</a>, or even <a href="https://www.infoworld.com/article/3640048/microsofts-kubernetes-for-the-rest-of-us.html">Azure Container Apps</a>, it’s worth considering where you can use other Azure services within your application. If you have dependencies on databases or other applications, you may well find using the Azure equivalent easier than setting up a virtual server to host the application. Alternatively, a cloud-optimized version and vendor-supported version may be in the Azure Marketplace. Similarly, where you might have used Active Directory for access control, consider using Azure Active Directory APIs as these are compatible with ephemeral containers.</p><p>Microsoft’s containerization documentation provides suitable alternatives for on-premises services that aren’t supported in containers. Switching to them may take time and require additional development work, which could be a problem with legacy applications. In some cases, as much as you may want to move to cloud-native and containers, it may prove uneconomical or too complex.</p><p>Containerization is a useful technique for building new cloud-native applications, treating containers as the endpoint of a CI/CD pipeline, and using Kubernetes to orchestrate and scale the services that make up your application. Microsoft’s own experience shows that moving from virtual infrastructures to cloud-native is possible, and its documentation provides pointers on how to make the necessary changes. It’s not easy, but as Microsoft 365 proves, the benefits can be well worth the engineering effort necessary.</p>
			
		
		
	
		
		
			
		
		
		
		
			
			
			
			











		
		
	<div class="content-copy">Copyright © 2022 IDG Communications, Inc.</div></body>