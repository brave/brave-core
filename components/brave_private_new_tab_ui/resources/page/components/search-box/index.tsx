// Copyright (c) 2022 The Brave Authors. All rights reserved.
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this file,
// you can obtain one at https://mozilla.org/MPL/2.0/.
import * as React from 'react'
import styled from 'styled-components'
import { getLocale } from '$web-common/locale'

const Box = styled.div`
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  gap: 40px;
  width: 100%;
`

const Form = styled.form`
  --bg-color: rgba(255, 255, 255, 0.22);
  --box-shadow: 0px 2px 70px rgba(0, 0, 0, 0.3);

  display: grid;
  grid-template-columns: 1fr 50px;
  align-items: center;
  width: 100%;
  height: 52px;
  font-family: ${p => p.theme.fontFamily.heading};
  color: white;
  font-size: 14px;
  font-weight: 400;
  background: var(--bg-color);
  border-radius: 8px;
  transition: box-shadow 0.3s ease-in-out;
  overflow: hidden;

  &:focus-within,
  &:hover {
    box-shadow: var(--box-shadow);
  }

  input[type="text"] {
    width: 100%;
    height: 36px;
    border: 0;
    background-color: transparent;
    padding: 5px 16px;

    &:focus {
      outline: 0;
    }

    &::placeholder {
      color: rgba(255,255,255,0.7);
    }
  }
`

const IconButton = styled.button`
  background: transparent;
  padding: 0;
  margin: 0;
  border: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    background: linear-gradient(304.74deg, #6F4CD2 15.81%, #BF14A2 63.17%, #F73A1C 100%);

    path {
      fill: white;
    }
  }
`

function BraveSearchLogo () {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" width="210" height="64" fill="none">
      <path fill="url(#a)" fillRule="evenodd" d="m54.318 15.321 1.523-3.676s-1.938-2.043-4.292-4.358c-2.353-2.315-7.337-.953-7.337-.953L38.536 0H18.601l-5.676 6.334s-4.983-1.362-7.337.953c-2.353 2.315-4.291 4.358-4.291 4.358l1.522 3.676-1.938 5.447s5.7 21.236 6.368 23.83c1.316 5.106 2.215 7.08 5.953 9.668 3.738 2.587 10.522 7.08 11.629 7.762 1.108.68 2.492 1.84 3.738 1.84s2.63-1.16 3.738-1.84c1.107-.681 7.89-5.175 11.628-7.762 3.738-2.587 4.638-4.562 5.953-9.668.668-2.594 6.368-23.83 6.368-23.83l-1.938-5.447Z" clipRule="evenodd"/>
      <path fill="#fff" d="M35.63 11.508c.83 0 6.99-1.157 6.99-1.157s7.3 8.68 7.3 10.536c0 1.534-.627 2.134-1.366 2.842-.155.148-.315.3-.475.468l-5.474 5.717a9.92 9.92 0 0 1-.179.18c-.546.54-1.35 1.336-.783 2.658l.117.269c.622 1.432 1.39 3.2.413 4.99-1.041 1.906-2.823 3.178-3.965 2.967-1.143-.21-3.825-1.589-4.811-2.218-.987-.63-4.113-3.166-4.113-4.137 0-.809 2.248-2.155 3.34-2.81.218-.13.39-.232.489-.298.112-.075.301-.19.533-.332.997-.61 2.798-1.71 2.843-2.197.056-.602.034-.778-.77-2.264-.17-.316-.37-.654-.577-1.004-.765-1.295-1.622-2.745-1.432-3.784.214-1.173 2.082-1.845 3.664-2.415.198-.07.391-.14.576-.209l1.648-.609c1.58-.582 3.336-1.229 3.625-1.36.4-.181.297-.355-.916-.468-.16-.015-.36-.036-.59-.06-1.502-.157-4.273-.446-5.62-.077-.265.073-.562.152-.873.235-1.514.403-3.369.897-3.547 1.182-.031.05-.062.093-.09.133-.171.238-.282.394-.094 1.406.056.302.172.895.315 1.629.418 2.148 1.07 5.498 1.152 6.25l.036.305c.105.84.175 1.399-.817 1.622l-.26.058c-1.118.252-2.758.623-3.35.623-.593 0-2.234-.37-3.353-.623l-.258-.058c-.991-.223-.921-.782-.817-1.622.012-.098.025-.2.036-.305.083-.753.737-4.112 1.155-6.259.142-.73.256-1.32.312-1.62.189-1.012.078-1.168-.093-1.406-.029-.04-.06-.083-.09-.133-.179-.285-2.033-.779-3.547-1.182-.311-.083-.608-.162-.873-.235-1.348-.37-4.118-.08-5.62.077-.23.024-.43.045-.59.06-1.214.113-1.317.287-.917.468.29.131 2.044.778 3.624 1.36.606.223 1.187.437 1.65.609.184.069.378.138.576.21 1.582.57 3.45 1.241 3.664 2.414.19 1.039-.667 2.489-1.432 3.784-.207.35-.407.688-.578 1.004-.804 1.486-.825 1.662-.77 2.264.046.488 1.846 1.587 2.843 2.197.232.142.42.257.534.332.099.066.27.168.487.298 1.092.654 3.341 2 3.341 2.81 0 .97-3.126 3.507-4.112 4.137-.987.63-3.669 2.008-4.81 2.218-1.143.21-2.925-1.061-3.966-2.966-.978-1.791-.21-3.559.413-4.99l.116-.27c.568-1.322-.237-2.118-.783-2.658-.064-.063-.124-.123-.178-.18l-5.475-5.717c-.16-.167-.32-.32-.474-.468-.74-.707-1.367-1.308-1.367-2.842 0-1.855 7.3-10.536 7.3-10.536s6.16 1.157 6.992 1.157c.662 0 1.942-.433 3.276-.885.338-.114.68-.23 1.015-.34 1.661-.545 2.769-.549 2.769-.549s1.107.004 2.769.549c.335.11.676.226 1.014.34 1.335.452 2.614.885 3.277.885Z"/>
      <path fill="#fff" d="M34.572 42.214c1.302.66 2.226 1.128 2.575 1.343.452.278.176.803-.235 1.09-.412.285-5.944 4.499-6.48 4.965-.07.06-.142.124-.218.191-.518.459-1.177 1.044-1.645 1.044-.468 0-1.128-.586-1.646-1.044-.075-.067-.148-.132-.217-.191-.537-.466-6.069-4.68-6.48-4.966-.412-.286-.688-.81-.236-1.09.35-.214 1.275-.683 2.578-1.344l1.24-.629c1.95-.992 4.381-1.837 4.76-1.837.38 0 2.811.844 4.762 1.837.444.226.859.437 1.242.63Z"/>
      <path fill="#F3F5F7" d="M81.233 21.553c1.648-.855 3.532-1.283 5.648-1.283 2.466 0 4.695.6 6.689 1.795 1.993 1.195 3.575 2.898 4.737 5.102 1.162 2.205 1.743 4.759 1.743 7.666s-.58 5.479-1.743 7.716c-1.162 2.237-2.744 3.972-4.737 5.205-1.998 1.232-4.228 1.846-6.688 1.846-2.154 0-4.034-.419-5.65-1.256-1.615-.837-2.909-1.92-3.877-3.256v4.051h-7.288V11.2h7.288v13.688c.935-1.367 2.23-2.479 3.877-3.33v-.005Zm10.31 8.847c-.713-1.246-1.648-2.195-2.81-2.846a7.597 7.597 0 0 0-3.774-.973c-1.35 0-2.56.335-3.722 1-1.162.666-2.102 1.633-2.81 2.898-.713 1.265-1.068 2.754-1.068 4.46 0 1.708.355 3.196 1.068 4.461.713 1.265 1.648 2.228 2.81 2.898a7.38 7.38 0 0 0 3.722 1c1.318 0 2.612-.34 3.774-1.024 1.162-.683 2.102-1.655 2.81-2.92.714-1.266 1.068-2.768 1.068-4.512 0-1.744-.354-3.186-1.068-4.433V30.4ZM113.2 21.605c1.511-.856 3.235-1.284 5.181-1.284v7.535h-1.927c-2.291 0-4.02.53-5.181 1.59-1.162 1.061-1.743 2.907-1.743 5.535v14.15h-7.288v-28.4h7.288v4.409a10.17 10.17 0 0 1 3.67-3.54v.005ZM121.059 27.195c1.162-2.223 2.74-3.93 4.738-5.125 1.993-1.196 4.227-1.796 6.688-1.796 2.154 0 4.033.428 5.649 1.284 1.615.856 2.905 1.93 3.878 3.228v-4.051h7.34v28.4h-7.34V44.98c-.936 1.335-2.23 2.438-3.878 3.307-1.649.87-3.547 1.307-5.701 1.307-2.428 0-4.643-.614-6.636-1.846-1.998-1.233-3.576-2.963-4.738-5.205-1.162-2.237-1.743-4.81-1.743-7.716 0-2.907.581-5.419 1.743-7.637v.004Zm19.913 3.256c-.694-1.246-1.629-2.204-2.81-2.87a7.623 7.623 0 0 0-3.802-1 7.502 7.502 0 0 0-3.75.973c-1.143.65-2.074 1.6-2.787 2.846-.713 1.247-1.068 2.726-1.068 4.433 0 1.706.355 3.204 1.068 4.483.713 1.284 1.648 2.265 2.81 2.95a7.22 7.22 0 0 0 3.722 1.022 7.722 7.722 0 0 0 3.802-1c1.181-.665 2.116-1.623 2.811-2.87.694-1.246 1.039-2.744 1.039-4.483 0-1.74-.35-3.237-1.039-4.484h.004ZM166.431 42.526l7.288-21.791h7.756l-10.675 28.4h-8.851l-10.623-28.4h7.807l7.288 21.79h.01ZM209.073 37.088h-21.085c.175 2.051.902 3.656 2.187 4.819 1.285 1.163 2.862 1.744 4.737 1.744 2.707 0 4.634-1.144 5.782-3.437h7.859c-.831 2.735-2.428 4.981-4.789 6.74-2.362 1.762-5.257 2.641-8.696 2.641-2.777 0-5.266-.604-7.472-1.818-2.206-1.214-3.92-2.93-5.153-5.154-1.233-2.223-1.847-4.786-1.847-7.688s.605-5.521 1.823-7.74c1.214-2.223 2.914-3.93 5.101-5.125 2.187-1.196 4.705-1.796 7.548-1.796 2.844 0 5.196.582 7.368 1.745 2.168 1.162 3.855 2.814 5.05 4.948 1.195 2.135 1.794 4.591 1.794 7.359 0 1.023-.07 1.948-.207 2.767v-.005Zm-7.34-4.818c-.033-1.847-.714-3.326-2.031-4.433-1.318-1.111-2.934-1.665-4.842-1.665-1.804 0-3.325.54-4.553 1.614-1.233 1.074-1.988 2.572-2.262 4.484h13.692-.004Z"/>
      <defs>
        <linearGradient id="a" x1=".881" x2="56.256" y1="64.319" y2="64.319" gradientUnits="userSpaceOnUse">
          <stop stopColor="#FF5601"/>
          <stop offset=".5" stopColor="#FF4000"/>
          <stop offset="1" stopColor="#FF1F01"/>
        </linearGradient>
      </defs>
    </svg>
  )
}

interface Props {
  onSubmit?: (value: string, openNewTab: boolean) => unknown
}

function Search (props: Props) {
  const [value, setValue] = React.useState('')
  const inputRef = React.useRef<HTMLInputElement>(null)

  const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setValue(e.currentTarget.value)
  }

  const handleFormBoxClick = () => {
    inputRef.current && inputRef.current.focus()
  }

  const handleSubmit = (e: React.ChangeEvent<HTMLFormElement>) => {
    e.preventDefault()
    props.onSubmit?.(value, false)
  }

  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (value === '') return

    if ((e.metaKey || e.ctrlKey) && (e.key === 'Enter')) {
      props.onSubmit?.(value, true)
    }
  }

  return (
    <Box>
      <BraveSearchLogo />
      <Form onSubmit={handleSubmit} onClick={handleFormBoxClick} role="search" aria-label="Brave">
        <input ref={inputRef} onChange={onInputChange} onKeyDown={handleKeyDown} type="text" placeholder={getLocale('searchPlaceholderLabel')} value={value} autoCapitalize="off" autoComplete="off" autoCorrect="off" spellCheck="false" aria-label="Search" title="Search" aria-autocomplete="none" aria-haspopup="false" maxLength={2048} autoFocus />
        <IconButton data-test-id="submit_button" aria-label="Submit">
          <svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M8 16a8 8 0 1 1 5.965-2.67l5.775 5.28a.8.8 0 1 1-1.08 1.18l-5.88-5.375A7.965 7.965 0 0 1 8 16Zm4.374-3.328a.802.802 0 0 0-.201.18 6.4 6.4 0 1 1 .202-.181Z" fill="url(#search_icon_gr)"/><defs><linearGradient id="search_icon_gr" x1="20" y1="20" x2="-2.294" y2="3.834" gradientUnits="userSpaceOnUse"><stop stopColor="#BF14A2"/><stop offset="1" stopColor="#F73A1C"/></linearGradient></defs></svg>
        </IconButton>
      </Form>
    </Box>
  )
}

export default Search
